<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>홈 네트워크 관리 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{ 
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        /* iOS 11 fallback */
        @supports(padding: constant(safe-area-inset-top)){
            :root{
                --safe-top: constant(safe-area-inset-top);
                --safe-bottom: constant(safe-area-inset-bottom);
            }
        }
        .safe-top{ padding-top: var(--safe-top); }
        .safe-bottom{ padding-bottom: var(--safe-bottom); }
        /* 문서 전체에서도 안전영역을 보장 */
        html, body { height: 100%; }
        body { padding-top: var(--safe-top); padding-bottom: var(--safe-bottom); }
        /* 터치 타깃 확대 (모바일 접근성) */
        :is(button, .tab-btn){ min-height: 44px; }
        /* 키보드 회피 애니메이션 */
        .avoid-keyboard{ transition: bottom .2s ease; }
        
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 네비게이션 바 -->
    <nav class="bg-blue-600 text-white p-4 shadow-lg safe-top">
        <div class="container mx-auto grid grid-cols-[1fr_auto] items-center gap-3 min-w-0">
            <h1 class="truncate text-base sm:text-lg md:text-xl font-bold leading-snug">
                홈 네트워크 관리 시스템
            </h1>
            <div id="user-info" class="hidden shrink-0 flex items-center gap-2">
                <span id="user-name" class="inline-flex items-center h-8 px-2 rounded bg-blue-700/0"></span>
                <span id="user-role" class="inline-flex items-center h-8 bg-blue-800 px-2 rounded text-xs sm:text-sm"></span>
                <button id="logout-btn" class="inline-flex items-center bg-red-500 hover:bg-red-600 px-3 h-8 rounded">
                    <i class="fas fa-sign-out-alt mr-1"></i>로그아웃
                </button>
            </div>
        </div>
    </nav>

    <!-- 메인 컨테이너 -->
    <div class="container mx-auto p-6">
        <!-- 로그인/회원가입 페이지 -->
        <div id="auth-page" class="max-w-md mx-auto">
            <div class="bg-white p-8 rounded-lg shadow-md">
                <h2 id="auth-title" class="text-2xl font-bold text-center mb-6">로그인</h2>
                
                <!-- 로그인 폼 -->
                <form id="login-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="email">
                            이메일
                        </label>
                        <input id="email" type="email" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="password">
                            비밀번호
                        </label>
                        <input id="password" type="password" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <button type="submit" 
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        로그인
                    </button>
                </form>

                <!-- 회원가입 폼 -->
                <form id="register-form" class="hidden">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-name">
                            이름
                        </label>
                        <input id="reg-name" type="text" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-email">
                            이메일
                        </label>
                        <input id="reg-email" type="email" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-phone">
                            전화번호
                        </label>
                        <input id="reg-phone" type="tel" inputmode="tel" autocomplete="tel" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-password">
                            비밀번호
                        </label>
                        <input id="reg-password" type="password" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-user-role">
                            사용자 권한
                        </label>
                        <select id="reg-user-role" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                            <option value="user">일반사용자</option>
                            <option value="admin">관리자</option>
                        </select>
                    </div>
                    <button type="submit" 
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                        회원가입
                    </button>
                </form>

                <!-- 로그인/회원가입 토글 -->
                <div class="mt-4 text-center">
                    <button id="toggle-auth" class="text-blue-600 hover:text-blue-800">
                        회원가입하기
                    </button>
                </div>
            </div>
        </div>

        <!-- 메인 대시보드 -->
        <div id="main-dashboard" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- 현장 등록 카드 -->
                <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="showPage('site-registration')">
                    <div class="flex items-start md:items-center">
                        <i class="fas fa-building text-blue-500 text-3xl mr-4 flex-shrink-0 leading-none"></i>
                        <div>
                            <h3 class="text-lg font-semibold">현장 등록</h3>
                            <p class="text-gray-600">새로운 현장 정보를 등록합니다</p>
                        </div>
                    </div>
                </div>                <!-- 일일업무관리 카드 -->
                <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="showPage('daily-work')">
                    <div class="flex items-start md:items-center">
                        <i class="fas fa-tasks text-green-500 text-3xl mr-4 flex-shrink-0 leading-none"></i>
                        <div>
                            <h3 class="text-lg font-semibold">일일업무관리</h3>
                            <p class="text-gray-600">스마트플랜과 Action Plan 관리</p>
                        </div>
                    </div>
                </div>

                <!-- 현장별 전체조회 카드 -->
                <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="showPage('site-overview')">
                    <div class="flex items-start md:items-center">
                        <i class="fas fa-chart-bar text-purple-500 text-3xl mr-4 flex-shrink-0 leading-none"></i>
                        <div>
                            <h3 class="text-lg font-semibold">현장별 전체조회</h3>
                            <p class="text-gray-600">등록된 현장들의 전체 현황 조회</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 현장 등록 페이지 -->
        <div id="site-registration-page" class="hidden">
            <div class="bg-white p-6 pb-24 rounded-lg shadow-md">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold">현장 등록</h2>
                    <div class="flex flex-col items-start gap-1 md:flex-row md:items-center md:gap-2">
                        <label class="text-lg text-gray-700 md:hidden">현장선택</label>
                        <label class="hidden md:inline-block text-sm text-gray-600">현장 선택</label>
                        <select id="site-select" class="px-3 py-2 border border-gray-300 rounded-md min-w-[240px]"></select>
                        <button id="refresh-sites" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-2 rounded border"><i class="fas fa-rotate mr-1"></i>새로고침</button>
                    </div>
                    <button onclick="showPage('dashboard')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-arrow-left mr-2"></i>돌아가기
                    </button>
                </div>

                <!-- 탭 네비게이션 -->
                <div class="border-b mb-6">
                    <nav class="flex flex-wrap gap-4" role="tablist">
                        <button class="tab-btn text-blue-600 border-b-2 border-blue-600 pb-2" data-tab="basic">기본정보</button>
                        <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="contacts">연락처</button>
                        <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="products">제품수량</button>
                        <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="household">세대부연동</button>
                        <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="common">공용부연동</button>
                    </nav>
                    
                    <!-- 최종 저장 버튼 -->
                    <div class="mt-4 flex justify-end">
                        <button id="final-save-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg">
                            <i class="fas fa-save mr-2"></i>최종 저장
                        </button>
                    </div>
                </div>
                
                <!-- 기본정보 탭 -->
                <form id="site-form" class="tab-panel grid grid-cols-1 md:grid-cols-2 gap-6" data-tab="basic">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                        <div class="flex">
                            <select id="project-no-prefix" class="mr-2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="NA/">NA/</option>
                                <option value="NE/">NE/</option>
                            </select>
                            <input type="text" id="project-no-number" maxlength="4" placeholder="1234" 
                                class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                oninput="this.value = this.value.replace(/[^0-9]/g, ''); checkProjectNoOnInput();">
                        </div>
                        <div id="project-no-error" class="text-sm text-red-600 mt-1 hidden"></div>
                    </div>
                    
                    <!-- 기본정보 섹션 -->
                    <div class="md:col-span-2">
                        <h3 class="text-lg font-semibold mb-4 text-blue-600">기본정보</h3>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">건설사</label>
                        <input type="text" id="construction-company" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">현장명</label>
                        <input type="text" id="site-name" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">주소</label>
                        <input type="text" id="address" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">상세주소</label>
                        <input type="text" id="detail-address" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">세대수</label>
                        <input type="number" id="household-count" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">제품 BI</label>
                        <input type="text" id="product-bi" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500" placeholder="예: BI 텍스트 입력">
                    </div>
                    
                    <!-- 날짜 입력 필드들 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">등록일</label>
                        <input type="date" id="registration-date" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500"
                            onchange="formatDateDisplay(this, 'registration-date-display')">
                        <div id="registration-date-display" class="text-sm text-gray-600 mt-1"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">납품예정</label>
                        <input type="date" id="delivery-date" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500"
                            onchange="formatDateDisplay(this, 'delivery-date-display')">
                        <div id="delivery-date-display" class="text-sm text-gray-600 mt-1"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">준공일</label>
                        <input type="date" id="completion-date" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500"
                            onchange="formatDateDisplay(this, 'completion-date-display')">
                        <div id="completion-date-display" class="text-sm text-gray-600 mt-1"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">인증심사여부</label>
                        <select id="certification-audit" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                            <option value="">선택하세요</option>
                            <option value="Y">예</option>
                            <option value="N">아니오</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">홈IoT연동여부</label>
                        <select id="home-iot" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                            <option value="">선택하세요</option>
                            <option value="Y">예</option>
                            <option value="N">아니오</option>
                        </select>
                    </div>
                    
                    <div class="md:col-span-2 mt-6">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                    </div>
                </form>

                <!-- 연락처 탭 -->
                <div id="contacts-tab" class="tab-panel hidden" data-tab="contacts">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div class="md:col-span-2 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                            <input type="text" id="contacts-project-no" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600">
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">연락처</h3>
                    <form id="contacts-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">PM 이름</label>
                            <input type="text" id="pm_name" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">PM 전화번호</label>
                            <input type="text" id="pm_phone" inputmode="tel" autocomplete="tel" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">영업담당 이름</label>
                            <input type="text" id="sales_manager_name" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">영업담당 전화번호</label>
                            <input type="text" id="sales_manager_phone" inputmode="tel" autocomplete="tel" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">건설담당 이름</label>
                            <input type="text" id="construction_manager_name" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">건설담당 전화번호</label>
                            <input type="text" id="construction_manager_phone" inputmode="tel" autocomplete="tel" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">설치점 이름</label>
                            <input type="text" id="installer_name" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">설치점 전화번호</label>
                            <input type="text" id="installer_phone" inputmode="tel" autocomplete="tel" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">네트워크점 이름</label>
                            <input type="text" id="network_manager_name" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">네트워크점 전화번호</label>
                            <input type="text" id="network_manager_phone" inputmode="tel" autocomplete="tel" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div class="md:col-span-2 mt-2">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                                <i class="fas fa-save mr-2"></i>저장
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 제품수량 탭 -->
                <div id="products-tab" class="tab-panel hidden" data-tab="products">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div class="md:col-span-3 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                            <input type="text" id="products-project-no" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600">
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold mb-4 text-blue-600">제품수량</h3>
                    <form id="products-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 월패드 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">월패드</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="wallpad_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>모델 A</option>
                                        <option>모델 B</option>
                                        <option>모델 C</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="wallpad_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <!-- 도어폰 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">도어폰</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="doorphone_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>모델 A</option>
                                        <option>모델 B</option>
                                        <option>모델 C</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="doorphone_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <!-- 로비폰 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">로비폰</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="lobbyphone_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>모델 A</option>
                                        <option>모델 B</option>
                                        <option>모델 C</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="lobbyphone_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="md:col-span-3 mt-2">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                                <i class="fas fa-save mr-2"></i>저장
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 세대부연동 탭 -->
                <div id="household-tab" class="tab-panel hidden" data-tab="household">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div class="md:col-span-3 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                            <input type="text" id="household-project-no" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600">
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">세대부연동</h3>
                    <form id="household-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 조명 SW -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">조명 SW 연동</label>
                            <select id="lighting_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="lighting_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="lighting_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="lighting_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="lighting_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 대기전력 SW -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">대기전력 SW 연동</label>
                            <select id="standby_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="standby_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="standby_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="standby_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="standby_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 가스감지기 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">가스감지기 연동</label>
                            <select id="gas_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="gas_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="gas_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="gas_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="gas_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 난방 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">난방 연동</label>
                            <select id="heating_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="heating_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="heating_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="heating_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="heating_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 환기 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">환기 연동</label>
                            <select id="ventilation_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="ventilation_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="ventilation_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="ventilation_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="ventilation_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 도어락 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">도어락 연동</label>
                            <select id="doorlock_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="doorlock_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="doorlock_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="doorlock_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="doorlock_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 에어컨 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">에어컨 연동</label>
                            <select id="aircon_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="aircon_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="aircon_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="aircon_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="aircon_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 실시간검침 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">실시간검침 연동</label>
                            <select id="realtime_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="realtime_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="realtime_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="realtime_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="realtime_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 환경감지 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">환경감지 연동</label>
                            <select id="env_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="env_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="env_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="env_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="env_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <div class="md:col-span-3 mt-2">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                                <i class="fas fa-save mr-2"></i>저장
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 공용부연동 탭 -->
                <div id="common-tab" class="tab-panel hidden" data-tab="common">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div class="md:col-span-3 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                            <input type="text" id="common-project-no" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600">
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">공용부연동</h3>
                    <form id="common-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 주차관제 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">주차관제 연동</label>
                            <select id="parking_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="parking_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parking_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parking_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="parking_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 원격검침 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">원격검침 연동</label>
                            <select id="metering_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="metering_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="metering_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="metering_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="metering_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- CCTV -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">CCTV 연동</label>
                            <select id="cctv_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="cctv_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="cctv_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="cctv_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="cctv_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 엘리베이터 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">엘리베이터 연동</label>
                            <select id="elevator_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="elevator_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="elevator_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="elevator_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="elevator_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 무인택배 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">무인택배 연동</label>
                            <select id="parcel_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="parcel_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parcel_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parcel_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="parcel_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 전기차충전 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">전기차충전 연동</label>
                            <select id="ev_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="ev_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="ev_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="ev_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="ev_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 주차위치 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">주차위치 연동</label>
                            <select id="parkingloc_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="parkingloc_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parkingloc_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parkingloc_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="parkingloc_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 원패스 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">원패스 연동</label>
                            <select id="onepass_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="onepass_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="onepass_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="onepass_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="onepass_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- RF카드 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">RF카드 연동</label>
                            <select id="rfcard_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="rfcard_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="rfcard_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="rfcard_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="rfcard_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <div class="md:col-span-3 mt-2">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                                <i class="fas fa-save mr-2"></i>저장
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 하단 앱형 탭바 (모바일 전용) -->
            <nav id="mobile-tabbar" class="fixed bottom-0 left-0 right-0 z-40 bg-white border-t shadow-sm safe-bottom md:hidden">
                <ul class="grid grid-cols-5 text-xs">
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="basic">
                            <i class="fas fa-list-alt text-base mb-0.5"></i>
                            <span>기본</span>
                        </button>
                    </li>
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="contacts">
                            <i class="fas fa-address-book text-base mb-0.5"></i>
                            <span>연락처</span>
                        </button>
                    </li>
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="products">
                            <i class="fas fa-boxes-stacked text-base mb-0.5"></i>
                            <span>제품</span>
                        </button>
                    </li>
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="household">
                            <i class="fas fa-house-chimney text-base mb-0.5"></i>
                            <span>세대부</span>
                        </button>
                    </li>
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="common">
                            <i class="fas fa-building text-base mb-0.5"></i>
                            <span>공용부</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- JavaScript 파일들 -->
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script src="js/temp-storage.js"></script>
    <script src="js/site-tabs.js"></script>
    <script src="js/site-basic.js"></script>
    <script src="js/site-contacts.js"></script>
    <script src="js/site-products.js"></script>
    <script src="js/site-household.js"></script>
    <script src="js/site-common.js"></script>

    <!-- FAB: 맨 위로 버튼 -->
    <button id="fab-back-to-top" aria-label="맨 위로" title="맨 위로"
            class="hidden fixed right-4 bottom-6 z-50 bg-blue-600 hover:bg-blue-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center safe-bottom avoid-keyboard">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- FAB 동작 스크립트 -->
    <script>
      (function(){
        const fab = document.getElementById('fab-back-to-top');
        if(!fab) return;
        const showAt = 300; // px 이상 스크롤 시 표시

        function onScroll(){
          if(window.scrollY > showAt){
            fab.classList.remove('hidden');
          }else{
            fab.classList.add('hidden');
          }
        }
        function scrollTopSmooth(){
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.addEventListener('scroll', onScroll, { passive: true });
        fab.addEventListener('click', scrollTopSmooth);
        onScroll();
      })();
    </script>

    <!-- 모바일 키보드 열림 시 FAB/탭바 밀림 보정 -->
    <script>
      (function(){
        const fab = document.getElementById('fab-back-to-top');
        const tabbar = document.getElementById('mobile-tabbar');
        const vv = window.visualViewport;
        if(!vv) return;

        function adjustUI(){
          const heightDiff = window.innerHeight - vv.height - vv.offsetTop; // 가려지는 하단 높이(키보드 유무)
          const extra = Math.max(0, Math.round(heightDiff));
          if(fab){ fab.style.bottom = (extra > 0 ? (extra + 16) : 24) + 'px'; }
          if(tabbar){ tabbar.style.bottom = (extra > 0 ? (extra) : 0) + 'px'; }
        }
        vv.addEventListener('resize', adjustUI);
        vv.addEventListener('scroll', adjustUI);
        window.addEventListener('orientationchange', adjustUI);
        adjustUI();
      })();
    </script>

    <!-- Capacitor StatusBar/Keyboard 네이티브 보정 (존재 시에만 동작) -->
    <script>
      (function(){
        const Cap = window.Capacitor;
        if(!Cap) return;
        const Plugins = Cap.Plugins || {};
        const StatusBar = Plugins.StatusBar;
        const Keyboard = Plugins.Keyboard;

        // 상태바 스타일/배경색 적용
        try{ StatusBar && StatusBar.setBackgroundColor && StatusBar.setBackgroundColor({ color: '#2563EB' }); }catch(e){}
        try{ StatusBar && StatusBar.setStyle && StatusBar.setStyle({ style: 'LIGHT' }); }catch(e){}
        try{ StatusBar && StatusBar.setOverlaysWebView && StatusBar.setOverlaysWebView({ overlay: false }); }catch(e){}

        // 키보드 리사이즈 모드 및 이벤트
        try{ Keyboard && Keyboard.setResizeMode && Keyboard.setResizeMode({ mode: 'body' }); }catch(e){}
        if(Keyboard && Keyboard.addListener){
          Keyboard.addListener('keyboardWillShow', info => {
            // visualViewport 핸들러가 추가 보정을 수행하므로 별도 처리 최소화
          });
          Keyboard.addListener('keyboardWillHide', () => {
            // 기본 위치로 복원 보조
            const fab = document.getElementById('fab-back-to-top');
            const tabbar = document.getElementById('mobile-tabbar');
            if(fab){ fab.style.bottom = '24px'; }
            if(tabbar){ tabbar.style.bottom = '0px'; }
          });
        }
      })();
    </script>

</body>
</html>