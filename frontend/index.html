<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <title>홈 네트워크 관리 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root{ 
            --safe-top: env(safe-area-inset-top);
            --safe-bottom: env(safe-area-inset-bottom);
        }
        /* iOS 11 fallback */
        @supports(padding: constant(safe-area-inset-top)){
            :root{
                --safe-top: constant(safe-area-inset-top);
                --safe-bottom: constant(safe-area-inset-bottom);
            }
        }
        .safe-top{ padding-top: var(--safe-top); }
        .safe-bottom{ padding-bottom: var(--safe-bottom); }
        /* 문서 전체에서도 안전영역을 보장 */
        html, body { height: 100%; }
        body { padding-top: var(--safe-top); padding-bottom: var(--safe-bottom); }
        /* 터치 타깃 확대 (모바일 접근성) */
        :is(button, .tab-btn){ min-height: 44px; }
        /* 키보드 회피 애니메이션 */
        .avoid-keyboard{ transition: bottom .2s ease; }
        
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- 네비게이션 바 -->
    <nav class="bg-blue-600 text-white p-4 shadow-lg safe-top">
        <div class="container mx-auto grid grid-cols-[1fr_auto] items-center gap-3 min-w-0">
            <h1 class="truncate text-base sm:text-lg md:text-xl font-bold leading-snug">
                홈 네트워크 관리 시스템
            </h1>
            <div id="user-info" class="hidden shrink-0 flex items-center gap-2">
                <span id="user-name" class="inline-flex items-center h-8 px-2 rounded bg-blue-700/0"></span>
                <span id="user-role" class="inline-flex items-center h-8 bg-blue-800 px-2 rounded text-xs sm:text-sm"></span>
                <button id="logout-btn" class="inline-flex items-center bg-red-500 hover:bg-red-600 px-3 h-8 rounded">
                    <i class="fas fa-sign-out-alt mr-1"></i>로그아웃
                </button>
            </div>
        </div>
    </nav>

    <!-- 메인 컨테이너 -->
    <div class="container mx-auto p-6">
        <!-- 로그인/회원가입 페이지 -->
        <div id="auth-page" class="max-w-md mx-auto">
            <div class="bg-white p-8 rounded-lg shadow-md">
                <h2 id="auth-title" class="text-2xl font-bold text-center mb-6">로그인</h2>
                
                <!-- 로그인 폼 -->
                <form id="login-form">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="email">
                            이메일
                        </label>
                        <input id="email" type="email" required list="email-suggestions" autocomplete="username email"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                        <datalist id="email-suggestions"></datalist>
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="password">
                            비밀번호
                        </label>
                        <input id="password" type="password" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4 flex items-center gap-2">
                        <input id="remember-email" type="checkbox" class="h-4 w-4">
                        <label for="remember-email" class="text-sm text-gray-700 select-none">이메일 기억하기</label>
                    </div>
                    <button type="submit" 
                        class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded">
                        로그인
                    </button>
                </form>

                <!-- 회원가입 폼 -->
                <form id="register-form" class="hidden">
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-name">
                            이름
                        </label>
                        <input id="reg-name" type="text" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-email">
                            이메일
                        </label>
                        <input id="reg-email" type="email" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-phone">
                            전화번호
                        </label>
                        <input id="reg-phone" type="tel" inputmode="tel" autocomplete="tel" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-4">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-password">
                            비밀번호
                        </label>
                        <input id="reg-password" type="password" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    <div class="mb-6">
                        <label class="block text-gray-700 text-sm font-bold mb-2" for="reg-user-role">
                            사용자 권한
                        </label>
                        <select id="reg-user-role" required
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                            <option value="user">일반사용자</option>
                            <option value="admin">관리자</option>
                        </select>
                    </div>
                    <button type="submit" 
                        class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded">
                        회원가입
                    </button>
                </form>

                <!-- 로그인/회원가입 토글 -->
                <div class="mt-4 text-center">
                    <button id="toggle-auth" class="text-blue-600 hover:text-blue-800">
                        회원가입하기
                    </button>
                </div>
            </div>
        </div>

        <!-- 메인 대시보드 -->
        <div id="main-dashboard" class="hidden">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <!-- 현장 등록 카드 -->
                <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="showPage('site-registration')">
                    <div class="flex items-start md:items-center">
                        <i class="fas fa-building text-blue-500 text-3xl mr-4 flex-shrink-0 leading-none"></i>
                        <div>
                            <h3 class="text-lg font-semibold">현장 등록</h3>
                            <p class="text-gray-600">새로운 현장 정보를 등록합니다</p>
                        </div>
                    </div>
                </div>                <!-- 현장별 업무관리 카드 -->
                <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="showPage('daily-work')">
                    <div class="flex items-start md:items-center">
                        <i class="fas fa-tasks text-green-500 text-3xl mr-4 flex-shrink-0 leading-none"></i>
                        <div>
                            <h3 class="text-lg font-semibold">현장별 업무관리</h3>
                            <p class="text-gray-600">스마트플랜과 Action Plan 관리</p>
                        </div>
                    </div>
                </div>

                <!-- 현장 사진등록 및 관리 카드 -->
                <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="showPage('site-photos')">
                    <div class="flex items-start md:items-center">
                        <i class="fas fa-camera text-purple-500 text-3xl mr-4 flex-shrink-0 leading-none"></i>
                        <div>
                            <h3 class="text-lg font-semibold">현장 사진등록 및 관리</h3>
                            <p class="text-gray-600">촬영/앨범에서 등록, 제목/일자 자동 저장</p>
                        </div>
                    </div>
                </div>

                <!-- 데이터 다운로드 카드 -->
                <div class="bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="openExportDialog()">
                    <div class="flex items-start md:items-center">
                        <i class="fas fa-file-zipper text-orange-500 text-3xl mr-4 flex-shrink-0 leading-none"></i>
                        <div>
                            <h3 class="text-lg font-semibold">데이터 다운로드</h3>
                            <p class="text-gray-600">CSV/XLSX와 사진 ZIP까지 한 번에 내보내기</p>
                        </div>
                    </div>
                </div>

                <!-- 관리자 카드 (관리자에게만 표시) -->
                <div id="admin-card" class="hidden bg-white p-6 rounded-lg shadow-md hover:shadow-lg transition-shadow cursor-pointer" onclick="showPage('admin')">
                    <div class="flex items-start md:items-center">
                        <i class="fas fa-user-shield text-red-500 text-3xl mr-4 flex-shrink-0 leading-none"></i>
                        <div>
                            <h3 class="text-lg font-semibold">관리자</h3>
                            <p class="text-gray-600">사용자 역할 변경</p>
                        </div>
                    </div>
                </div>

                
            </div>
        </div>

        <!-- 현장별 업무관리 페이지 -->
        <div id="site-work-page" class="hidden">
            <div class="bg-white p-6 pb-24 rounded-lg shadow-md">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold flex items-center gap-3">
                        현장별 업무관리
                        <button id="work-bell" class="relative inline-flex items-center justify-center w-10 h-10 rounded-full bg-blue-50 text-blue-600">
                            <i class="fas fa-bell"></i>
                            <span id="work-bell-badge" class="hidden absolute -top-1 -right-1 min-w-[20px] h-[20px] px-1 rounded-full bg-red-600 text-white text-xs flex items-center justify-center"></span>
                        </button>
                    </h2>
                    <div class="flex flex-col items-start gap-1 md:flex-row md:items-center md:gap-2">
                        <label class="text-lg text-gray-700 md:hidden">현장선택</label>
                        <label class="hidden md:inline-block text-sm text-gray-600">현장 선택</label>
                        <select id="work-site-select" class="px-3 py-2 border border-gray-300 rounded-md min-w-[240px]"></select>
                        <button id="work-refresh-sites" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-2 rounded border"><i class="fas fa-rotate mr-1"></i>새로고침</button>
                        <button onclick="showPage('dashboard')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded md:ml-2">
                            <i class="fas fa-arrow-left mr-2"></i>돌아가기
                        </button>
                    </div>
                </div>

                <!-- 탭 네비게이션 (To do / Done / 알람 List + 우측에 + 버튼) -->
                <div class="border-b mb-6">
                    <nav class="flex items-center justify-between" role="tablist">
                        <div class="flex gap-6">
                            <button class="work-tab-btn text-blue-600 border-b-2 border-blue-600 pb-2" data-tab="todo">To do</button>
                            <button class="work-tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="done">Done</button>
                            <button class="work-tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="alarms">알람 List</button>
                        </div>
                        <button id="work-add-row" class="text-blue-600 hover:text-blue-700 text-xl" title="행 추가">
                            <i class="fas fa-plus"></i>
                        </button>
                    </nav>
                </div>

                <!-- To do 탭 패널 -->
                <div id="work-tab-todo" class="work-tab-panel" data-tab="todo">
                    <!-- 모바일 카드 -->
                    <div class="md:hidden space-y-3" id="work-todo-cards"></div>
                    <!-- 데스크톱 테이블 -->
                    <div class="hidden md:block overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="text-gray-600">
                                <tr>
                                    <th class="text-left py-2 pr-4">알람일</th>
                                    <th class="text-left py-2 pr-4">할 일</th>
                                    <th class="text-left py-2">완료</th>
                                </tr>
                            </thead>
                            <tbody id="work-todo-tbody"></tbody>
                        </table>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button id="work-save-todo" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                    </div>
                </div>

                <!-- Done 탭 패널 -->
                <div id="work-tab-done" class="work-tab-panel hidden" data-tab="done">
                    <!-- 모바일 카드 -->
                    <div class="md:hidden space-y-3" id="work-done-cards"></div>
                    <!-- 데스크톱 테이블 -->
                    <div class="hidden md:block overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="text-gray-600">
                                <tr>
                                    <th class="text-left py-2 pr-4">일자</th>
                                    <th class="text-left py-2 pr-4">한 일</th>
                                </tr>
                            </thead>
                            <tbody id="work-done-tbody"></tbody>
                        </table>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button id="work-save-done" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                    </div>
                </div>

                <!-- 알람 List 탭 패널 -->
                <div id="work-tab-alarms" class="work-tab-panel hidden" data-tab="alarms">
                    <div class="overflow-x-auto">
                        <table class="min-w-full text-sm">
                            <thead class="text-gray-600">
                                <tr>
                                    <th class="text-left py-2 pr-4">현장명</th>
                                    <th class="text-left py-2 pr-4">할 일</th>
                                    <th class="text-left py-2">확인</th>
                                </tr>
                            </thead>
                            <tbody id="work-alarms-tbody"></tbody>
                        </table>
                    </div>
                    <div class="mt-4 flex justify-end">
                        <button id="work-save-alarms" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 관리자 페이지 (사용자 역할 관리) -->
        <div id="admin-page" class="hidden">
            <div class="bg-white p-6 rounded-lg shadow-md">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-2xl font-bold">관리자: 사용자 역할 관리</h2>
                    <button onclick="showPage('dashboard')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">돌아가기</button>
                </div>
                <div id="admin-users-wrap">
                    <table class="min-w-full text-sm">
                        <thead class="text-gray-600">
                            <tr>
                                <th class="text-left py-2 pr-4">이메일</th>
                                <th class="text-left py-2 pr-4">이름</th>
                                <th class="text-left py-2 pr-4">전화</th>
                                <th class="text-left py-2 pr-4">역할</th>
                                <th class="text-left py-2">변경</th>
                            </tr>
                        </thead>
                        <tbody id="admin-users-tbody"></tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- 현장 사진등록 및 관리 페이지 -->
        <div id="site-photos-page" class="hidden">
            <div class="bg-white p-6 pb-24 rounded-lg shadow-md">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold flex items-center gap-3">
                        현장 사진등록 및 관리
                    </h2>
                    <div class="flex flex-col items-start gap-1 md:flex-row md:items-center md:gap-2">
                        <label class="text-lg text-gray-700 md:hidden">현장선택</label>
                        <label class="hidden md:inline-block text-sm text-gray-600">현장 선택</label>
                        <select id="photos-site-select" class="px-3 py-2 border border-gray-300 rounded-md min-w-[240px]"></select>
                        <button id="photos-refresh-sites" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-2 rounded border"><i class="fas fa-rotate mr-1"></i>새로고침</button>
                        <button onclick="showPage('dashboard')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded md:ml-2">
                            <i class="fas fa-arrow-left mr-2"></i>돌아가기
                        </button>
                    </div>
                </div>

                <!-- 상단 입력 영역: 제목 + 업로드 버튼들 -->
                <div class="flex flex-col md:flex-row gap-3 items-stretch md:items-end mb-6">
                    <div class="flex-1">
                        <label class="block text-sm text-gray-700 mb-1">제목</label>
                        <input id="photo-title" type="text" placeholder="간략한 제목을 입력" class="w-full px-3 py-2 border rounded-md">
                    </div>
                    <div class="flex gap-2">
                        <label class="inline-flex items-center gap-2 bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded cursor-pointer">
                            <i class="fas fa-camera"></i>
                            사진촬영
                            <input id="photo-camera" type="file" accept="image/*" capture="environment" class="hidden">
                        </label>
                        <label class="inline-flex items-center gap-2 bg-indigo-600 hover:bg-indigo-700 text-white font-medium px-4 py-2 rounded cursor-pointer">
                            <i class="fas fa-image"></i>
                            앨범에서 불러오기
                            <input id="photo-gallery" type="file" accept="image/*" class="hidden">
                        </label>
                    </div>
                </div>

                <!-- 사진 그리드 -->
                <div id="photos-grid" class="grid grid-cols-2 md:grid-cols-4 gap-4"></div>
            </div>
        </div>
        <!-- 현장 등록 페이지 -->
        <div id="site-registration-page" class="hidden">
            <div class="bg-white p-6 pb-24 rounded-lg shadow-md">
                <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-6 gap-4">
                    <h2 class="text-2xl font-bold">현장 등록</h2>
                    <div class="flex flex-col items-start gap-1 md:flex-row md:items-center md:gap-2">
                        <label class="text-lg text-gray-700 md:hidden">현장선택</label>
                        <label class="hidden md:inline-block text-sm text-gray-600">현장 선택</label>
                        <select id="site-select" class="px-3 py-2 border border-gray-300 rounded-md min-w-[240px]"></select>
                        <button id="refresh-sites" class="bg-gray-100 hover:bg-gray-200 text-gray-800 px-3 py-2 rounded border"><i class="fas fa-rotate mr-1"></i>새로고침</button>
                        <button id="new-site-btn" class="bg-blue-50 hover:bg-blue-100 text-blue-700 px-3 py-2 rounded border border-blue-200" title="신규 현장 등록">
                            <i class="fas fa-plus mr-1"></i>신규
                        </button>
                    </div>
                    <button onclick="showPage('dashboard')" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        <i class="fas fa-arrow-left mr-2"></i>돌아가기
                    </button>
                </div>

                <!-- 탭 네비게이션 -->
                <div class="border-b mb-6">
                    <nav class="flex flex-wrap gap-4" role="tablist">
                        <button class="tab-btn text-blue-600 border-b-2 border-blue-600 pb-2" data-tab="basic">기본정보</button>
                        <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="contacts">연락처</button>
                        <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="products">제품수량</button>
                        <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="household">세대부연동</button>
                        <button class="tab-btn text-gray-600 hover:text-blue-600 pb-2" data-tab="common">공용부연동</button>
                    </nav>
                    
                    <!-- 최종 저장 버튼 -->
                    <div class="mt-4 flex justify-end">
                        <button id="final-save-btn" class="bg-green-600 hover:bg-green-700 text-white font-bold py-3 px-8 rounded-lg shadow-lg">
                            <i class="fas fa-save mr-2"></i>최종 저장
                        </button>
                    </div>
                </div>
                
                <!-- 기본정보 탭 -->
                <form id="site-form" class="tab-panel grid grid-cols-1 md:grid-cols-2 gap-6" data-tab="basic">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                        <div class="flex">
                            <select id="project-no-prefix" class="mr-2 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="NA/">NA/</option>
                                <option value="NE/">NE/</option>
                            </select>
                            <input type="text" id="project-no-number" maxlength="4" placeholder="1234" 
                                class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500" 
                                oninput="this.value = this.value.replace(/[^0-9]/g, ''); checkProjectNoOnInput();">
                        </div>
                        <div id="project-no-error" class="text-sm text-red-600 mt-1 hidden"></div>
                    </div>
                    
                    <!-- 기본정보 섹션 -->
                    <div class="md:col-span-2">
                        <h3 class="text-lg font-semibold mb-4 text-blue-600">기본정보</h3>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">건설사</label>
                        <input type="text" id="construction-company" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">현장명</label>
                        <input type="text" id="site-name" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">주소</label>
                        <input type="text" id="address" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">상세주소</label>
                        <input type="text" id="detail-address" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">세대수</label>
                        <input type="number" id="household-count" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                    </div>

                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">제품 BI</label>
                        <input type="text" id="product-bi" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500" placeholder="예: BI 텍스트 입력">
                    </div>

                    <!-- 외부망 연동 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">외부망 연동</label>
                        <select id="external-network-enabled" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                            <option value="N">아니오</option>
                            <option value="Y">예</option>
                        </select>
                    </div>
                    <div id="external-period-wrap" class="hidden">
                        <label class="block text-sm font-medium text-gray-700 mb-2">가입기간</label>
                        <input type="text" id="external-network-period"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500" placeholder="예: 2025.01 ~ 2026.12">
                    </div>

                    <!-- 현장 특이사항 -->
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-2">현장 특이사항</label>
                        <textarea id="special-notes" maxlength="1000" rows="4"
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500"
                            placeholder="최대 1000자까지 입력"></textarea>
                        <div id="special-notes-count" class="text-xs text-gray-500 mt-1">0/1000</div>
                    </div>
                    
                    <!-- 날짜 입력 필드들 -->
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">등록일</label>
                        <input type="date" id="registration-date" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500"
                            onchange="formatDateDisplay(this, 'registration-date-display')">
                        <div id="registration-date-display" class="text-sm text-gray-600 mt-1"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">납품예정</label>
                        <input type="date" id="delivery-date" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500"
                            onchange="formatDateDisplay(this, 'delivery-date-display')">
                        <div id="delivery-date-display" class="text-sm text-gray-600 mt-1"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">준공일</label>
                        <input type="date" id="completion-date" 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500"
                            onchange="formatDateDisplay(this, 'completion-date-display')">
                        <div id="completion-date-display" class="text-sm text-gray-600 mt-1"></div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">인증심사여부</label>
                        <select id="certification-audit" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                            <option value="">선택하세요</option>
                            <option value="Y">예</option>
                            <option value="N">아니오</option>
                        </select>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">홈IoT연동여부</label>
                        <select id="home-iot" required 
                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:border-blue-500">
                            <option value="">선택하세요</option>
                            <option value="Y">예</option>
                            <option value="N">아니오</option>
                        </select>
                    </div>
                    
                    <div class="md:col-span-2 mt-6">
                        <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                    </div>
                </form>

                <!-- 연락처 탭 -->
                <div id="contacts-tab" class="tab-panel hidden" data-tab="contacts">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div class="md:col-span-2 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                            <input type="text" id="contacts-project-no" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600">
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">연락처</h3>
                    <form id="contacts-form" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">PM 이름</label>
                            <input type="text" id="pm_name" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">PM 전화번호</label>
                            <input type="text" id="pm_phone" inputmode="tel" autocomplete="tel" class="w-full px-3 py-2 border border-gray-300 rounded-md">
                        </div>
                        <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">영업담당자</label>
                        <div id="sales-list" class="space-y-2">
                          <div class="flex gap-2 items-center">
                            <input type="text" id="sales_manager_name" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" placeholder="이름">
                            <input type="text" id="sales_manager_phone" class="w-44 px-3 py-2 border border-gray-300 rounded-md" placeholder="전화">
                            <button type="button" id="sales-add" class="px-3 py-2 border rounded text-blue-600">+</button>
                          </div>
                        </div>
                        </div>
                        <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">건설사 담당자</label>
                        <div id="construction-list" class="space-y-2">
                          <div class="flex gap-2 items-center">
                            <input type="text" id="construction_manager_name" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" placeholder="이름">
                            <input type="text" id="construction_manager_phone" class="w-44 px-3 py-2 border border-gray-300 rounded-md" placeholder="전화">
                            <button type="button" id="construction-add" class="px-3 py-2 border rounded text-blue-600">+</button>
                          </div>
                        </div>
                        </div>
                        <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">설치점</label>
                        <div id="installer-list" class="space-y-2">
                          <div class="flex gap-2 items-center">
                            <input type="text" id="installer_name" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" placeholder="업체/담당자">
                            <input type="text" id="installer_phone" class="w-44 px-3 py-2 border border-gray-300 rounded-md" placeholder="전화">
                            <button type="button" id="installer-add" class="px-3 py-2 border rounded text-blue-600">+</button>
                          </div>
                        </div>
                        </div>
                        <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">네트워크점</label>
                        <div id="network-list" class="space-y-2">
                          <div class="flex gap-2 items-center">
                            <input type="text" id="network_manager_name" class="flex-1 px-3 py-2 border border-gray-300 rounded-md" placeholder="업체/담당자">
                            <input type="text" id="network_manager_phone" class="w-44 px-3 py-2 border border-gray-300 rounded-md" placeholder="전화">
                            <button type="button" id="network-add" class="px-3 py-2 border rounded text-blue-600">+</button>
                          </div>
                        </div>
                        </div>
                        <div class="md:col-span-2 mt-2">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                                <i class="fas fa-save mr-2"></i>저장
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 제품수량 탭 -->
                <div id="products-tab" class="tab-panel hidden" data-tab="products">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div class="md:col-span-3 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                            <input type="text" id="products-project-no" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600">
                        </div>
                    </div>

                    <h3 class="text-lg font-semibold mb-4 text-blue-600">제품수량</h3>
                    <form id="products-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 월패드 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">월패드</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="wallpad_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>NHN-1031R</option>
                                        <option>NHN-1031C</option>
                                        <option>NHN-1031(N)</option>
                                        <option>NHN-1041</option>
                                        <option>NHN-1041(N)</option>
                                        <option>NHN-1051</option>
                                        <option>NHN-1051(N)</option>
                                        <option>NHN-1311</option>
                                        <option>NHN-1311(N)</option>
                                        <option>LE-1000</option>
                                        <option>LE-2000</option>
                                        <option>SNP-520</option>
                                        <option>SNP-720</option>
                                        <option>SNP-521</option>
                                        <option>SNP-721</option>
                                        <option>SNP-920</option>
                                        <option>SNP-521-LH</option>
                                        <option>NHN-07A1</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="wallpad_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <!-- 도어폰 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">도어폰</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="doorphone_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>NHN-DP81</option>
                                        <option>NHN-DP82</option>
                                        <option>NHN-DP83</option>
                                        <option>NHN-DP91</option>
                                        <option>NHN-DP92</option>
                                        <option>NHN-DP93</option>
                                        <option>LE-DP1000</option>
                                        <option>SEP910-4BW</option>
                                        <option>SEP920-4BW</option>
                                        <option>SEP520-4BW</option>
                                        <option>SEP320-4BW</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="doorphone_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <!-- 로비폰 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">로비폰</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="lobbyphone_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>NHN-LP41R</option>
                                        <option>NHN-LP51T</option>
                                        <option>NHN-LP51A</option>
                                        <option>SLP710</option>
                                        <option>SLP720</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="lobbyphone_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <!-- 경비실기 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">경비실기</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="guardphone_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>SGP510-5TW</option>
                                        <option>SGP511-4TW</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="guardphone_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <!-- 자석감지기 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">자석감지기</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="magnet_sensor_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>HD-MDT(HD)</option>
                                        <option>MS-1205(KMT)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="magnet_sensor_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <!-- 동체감지기 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">동체감지기</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델</label>
                                    <select id="motion_sensor_model" class="w-full px-3 py-2 border rounded-md">
                                        <option value="">선택</option>
                                        <option>HD-P112(HD)</option>
                                        <option>PA-0612(KMT)</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="motion_sensor_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <!-- 개폐기 -->
                        <div class="md:col-span-3">
                            <h4 class="font-semibold mb-2">개폐기</h4>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">모델(자유 입력)</label>
                                    <input type="text" id="opener_model" class="w-full px-3 py-2 border rounded-md" placeholder="모델명 입력">
                                </div>
                                <div>
                                    <label class="block text-sm text-gray-700 mb-2">수량</label>
                                    <input type="number" id="opener_qty" class="w-full px-3 py-2 border rounded-md" min="0" value="0">
                                </div>
                            </div>
                        </div>
                        <div class="md:col-span-3 mt-2">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                                <i class="fas fa-save mr-2"></i>저장
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 세대부연동 탭 -->
                <div id="household-tab" class="tab-panel hidden" data-tab="household">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div class="md:col-span-3 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                            <input type="text" id="household-project-no" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600">
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">세대부연동</h3>
                    <form id="household-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 조명 SW -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">조명 SW 연동</label>
                            <select id="lighting_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="lighting_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="lighting_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="lighting_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="lighting_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 대기전력 SW -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">대기전력 SW 연동</label>
                            <select id="standby_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="standby_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="standby_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="standby_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="standby_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 가스감지기 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">가스감지기 연동</label>
                            <select id="gas_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="gas_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="gas_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="gas_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="gas_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 난방 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">난방 연동</label>
                            <select id="heating_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="heating_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="heating_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="heating_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="heating_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 환기 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">환기 연동</label>
                            <select id="ventilation_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="ventilation_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="ventilation_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="ventilation_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="ventilation_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 도어락 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">도어락 연동</label>
                            <select id="doorlock_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="doorlock_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="doorlock_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="doorlock_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="doorlock_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 에어컨 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">에어컨 연동</label>
                            <select id="aircon_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="aircon_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="aircon_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="aircon_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="aircon_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 실시간검침 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">실시간검침 연동</label>
                            <select id="realtime_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="realtime_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="realtime_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="realtime_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="realtime_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 환경감지 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">환경감지 연동</label>
                            <select id="env_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="env_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="env_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="env_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="env_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 욕실폰 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">욕실폰 연동</label>
                            <select id="bathphone_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="bathphone_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="bathphone_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="bathphone_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="bathphone_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 주방 TV -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">주방 TV 연동</label>
                            <select id="kitchentv_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="kitchentv_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="kitchentv_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="kitchentv_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="kitchentv_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- VPN -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">VPN 연동</label>
                            <select id="vpn_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="vpn_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="vpn_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="vpn_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="vpn_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 일괄소등스위치 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">일괄소등스위치 연동</label>
                            <select id="alloff_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="alloff_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="alloff_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="alloff_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="alloff_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <div class="md:col-span-3 mt-2">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                                <i class="fas fa-save mr-2"></i>저장
                            </button>
                        </div>
                    </form>
                </div>

                <!-- 공용부연동 탭 -->
                <div id="common-tab" class="tab-panel hidden" data-tab="common">
                    <!-- 프로젝트 No. (맨 위) -->
                    <div class="md:col-span-3 mb-6">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">프로젝트 No.</label>
                            <input type="text" id="common-project-no" disabled
                                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100 text-gray-600">
                        </div>
                    </div>
                    
                    <h3 class="text-lg font-semibold mb-4 text-blue-600">공용부연동</h3>
                    <form id="common-form" class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <!-- 주차관제 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">주차관제 연동</label>
                            <select id="parking_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="parking_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parking_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parking_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="parking_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- 원격검침 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">원격검침 연동</label>
                            <select id="metering_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="metering_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="metering_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="metering_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="metering_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <!-- CCTV -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">CCTV 연동</label>
                            <select id="cctv_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="cctv_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="cctv_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="cctv_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="cctv_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 엘리베이터 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">엘리베이터 연동</label>
                            <select id="elevator_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="elevator_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="elevator_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="elevator_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="elevator_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 무인택배 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">무인택배 연동</label>
                            <select id="parcel_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="parcel_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parcel_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parcel_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="parcel_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 전기차충전 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">전기차충전 연동</label>
                            <select id="ev_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="ev_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="ev_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="ev_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="ev_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 주차위치 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">주차위치 연동</label>
                            <select id="parkingloc_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="parkingloc_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parkingloc_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="parkingloc_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="parkingloc_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- 원패스 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">원패스 연동</label>
                            <select id="onepass_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="onepass_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="onepass_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="onepass_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="onepass_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>

                        <!-- RF카드 -->
                        <div>
                            <label class="block text-sm text-gray-700 mb-2">RF카드 연동</label>
                            <select id="rfcard_enabled" class="w-full px-3 py-2 border rounded-md">
                                <option value="Y" selected>예</option>
                                <option value="N">아니오</option>
                            </select>
                            <input type="text" id="rfcard_company" placeholder="업체명" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="rfcard_contact_person" placeholder="업체 담당자" class="mt-2 w-full px-3 py-2 border rounded-md">
                            <input type="text" id="rfcard_contact_phone" placeholder="연락처" class="mt-2 w-full px-3 py-2 border rounded-md" inputmode="tel" autocomplete="tel">
                            <input type="text" id="rfcard_notes" placeholder="기타" class="mt-2 w-full px-3 py-2 border rounded-md">
                        </div>
                        <div class="md:col-span-3 mt-2">
                            <button type="submit" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-6 rounded">
                                <i class="fas fa-save mr-2"></i>저장
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- 하단 앱형 탭바 (모바일 전용) -->
            <nav id="mobile-tabbar" class="fixed bottom-0 left-0 right-0 z-40 bg-white border-t shadow-sm safe-bottom md:hidden">
                <ul class="grid grid-cols-5 text-xs">
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="basic">
                            <i class="fas fa-list-alt text-base mb-0.5"></i>
                            <span>기본</span>
                        </button>
                    </li>
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="contacts">
                            <i class="fas fa-address-book text-base mb-0.5"></i>
                            <span>연락처</span>
                        </button>
                    </li>
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="products">
                            <i class="fas fa-boxes-stacked text-base mb-0.5"></i>
                            <span>제품</span>
                        </button>
                    </li>
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="household">
                            <i class="fas fa-house-chimney text-base mb-0.5"></i>
                            <span>세대부</span>
                        </button>
                    </li>
                    <li>
                        <button class="tab-btn flex flex-col items-center justify-center py-2 text-gray-600 w-full" data-tab="common">
                            <i class="fas fa-building text-base mb-0.5"></i>
                            <span>공용부</span>
                        </button>
                    </li>
                </ul>
            </nav>
        </div>
    </div>

    <!-- JavaScript 파일들 -->
    <script src="js/auth.js"></script>
    <script src="js/app.js"></script>
    <script src="js/temp-storage.js"></script>
    <script src="js/site-tabs.js"></script>
    <script src="js/site-work.js"></script>
    <script src="js/site-basic.js"></script>
    <script src="js/site-contacts.js"></script>
    <script src="js/site-products.js"></script>
    <script src="js/site-household.js"></script>
    <script src="js/site-common.js"></script>
    <script src="js/site-photos.js"></script>

    <!-- FAB: 맨 위로 버튼 -->
    <button id="fab-back-to-top" aria-label="맨 위로" title="맨 위로"
            class="hidden fixed right-4 bottom-6 z-50 bg-blue-600 hover:bg-blue-700 text-white w-12 h-12 rounded-full shadow-lg flex items-center justify-center safe-bottom avoid-keyboard">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- FAB 동작 스크립트 -->
    <script>
      (function(){
        const fab = document.getElementById('fab-back-to-top');
        if(!fab) return;
        const showAt = 300; // px 이상 스크롤 시 표시

        function onScroll(){
          if(window.scrollY > showAt){
            fab.classList.remove('hidden');
          }else{
            fab.classList.add('hidden');
          }
        }
        function scrollTopSmooth(){
          window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        window.addEventListener('scroll', onScroll, { passive: true });
        fab.addEventListener('click', scrollTopSmooth);
        onScroll();
      })();
    </script>

    <!-- 모바일 키보드 열림 시 FAB/탭바 밀림 보정 (iOS 16+ 오검지 방지 강화) -->
    <script>
      (function(){
        const fab = document.getElementById('fab-back-to-top');
        const tabbar = document.getElementById('mobile-tabbar');
        const vv = window.visualViewport;

        // 텍스트 입력 포커스 여부 추적 (키보드 여부 추정용)
        let isTextInputFocused = false;
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;

        function isTextEditable(el){
          if(!el) return false;
          const tag = el.tagName;
          const type = (el.type || '').toLowerCase();
          if(tag === 'TEXTAREA') return true;
          if(tag === 'INPUT'){
            return ['text','search','tel','url','email','password','number'].includes(type);
          }
          if(el.isContentEditable) return true;
          return false;
        }

        document.addEventListener('focusin', ()=>{ isTextInputFocused = isTextEditable(document.activeElement); });
        document.addEventListener('focusout', ()=>{ isTextInputFocused = false; setTimeout(resetUI, 0); });

        if(!vv) return;

        function resetUI(){
          if(fab){ fab.style.bottom = '24px'; }
          if(tabbar){ tabbar.style.bottom = '0px'; }
        }

        function adjustUI(){
          // 가려지는 하단 높이(키보드 유무 추정)
          const heightDiff = window.innerHeight - vv.height - vv.offsetTop;
          const extra = Math.max(0, Math.round(heightDiff));

          // 키보드로 판단할 최소 임계값: 화면의 22% 또는 180px 중 큰 값
          const ratioThreshold = Math.round(window.innerHeight * 0.22);
          const pixelThreshold = 180;
          const minThreshold = Math.max(pixelThreshold, ratioThreshold);

          // iOS에서는 텍스트 입력 포커스 + 충분한 extra + 축소되지 않은(scale=1) 뷰포트일 때만 보정
          const keyboardLikely = isIOS
            ? (isTextInputFocused && extra >= minThreshold && vv.height < window.innerHeight && vv.scale === 1)
            : (extra >= minThreshold && vv.height < window.innerHeight);

          if(keyboardLikely){
            if(fab){ fab.style.bottom = (extra + 16) + 'px'; }
            if(tabbar){ tabbar.style.bottom = extra + 'px'; }
          }else{
            resetUI();
          }
        }

        // iOS 일반 스크롤 시에도 잔여 보정값 제거(키보드가 아닌 콘텐츠 스크롤 상황)
        let scrollDebounce = null;
        function onWindowScroll(){
          if(!isIOS) return;
          if(scrollDebounce) return;
          scrollDebounce = setTimeout(()=>{
            scrollDebounce = null;
            // 현재 상태가 키보드로 판단되지 않으면 즉시 리셋
            const heightDiff = window.innerHeight - vv.height - vv.offsetTop;
            const extra = Math.max(0, Math.round(heightDiff));
            const ratioThreshold = Math.round(window.innerHeight * 0.22);
            const pixelThreshold = 180;
            const minThreshold = Math.max(pixelThreshold, ratioThreshold);
            const keyboardLikely = isTextInputFocused && extra >= minThreshold && vv.height < window.innerHeight && vv.scale === 1;
            if(!keyboardLikely){ resetUI(); }
          }, 60);
        }

        vv.addEventListener('resize', adjustUI);
        vv.addEventListener('scroll', adjustUI);
        // 일반 페이지 스크롤에도 보정 재평가(iOS 한정)
        window.addEventListener('scroll', onWindowScroll, { passive: true });
        window.addEventListener('orientationchange', ()=>{ resetUI(); setTimeout(adjustUI, 0); });
        adjustUI();
      })();
    </script>

    <!-- Capacitor StatusBar/Keyboard 네이티브 보정 (존재 시에만 동작) -->
    <script>
      (function(){
        const Cap = window.Capacitor;
        if(!Cap) return;
        const Plugins = Cap.Plugins || {};
        const StatusBar = Plugins.StatusBar;
        const Keyboard = Plugins.Keyboard;

        // 상태바 스타일/배경색 적용
        try{ StatusBar && StatusBar.setBackgroundColor && StatusBar.setBackgroundColor({ color: '#2563EB' }); }catch(e){}
        try{ StatusBar && StatusBar.setStyle && StatusBar.setStyle({ style: 'LIGHT' }); }catch(e){}
        try{ StatusBar && StatusBar.setOverlaysWebView && StatusBar.setOverlaysWebView({ overlay: false }); }catch(e){}

        // 키보드 리사이즈 모드 및 이벤트
        try{ Keyboard && Keyboard.setResizeMode && Keyboard.setResizeMode({ mode: 'body' }); }catch(e){}
        if(Keyboard && Keyboard.addListener){
          Keyboard.addListener('keyboardWillShow', info => {
            // visualViewport 핸들러가 추가 보정을 수행하므로 별도 처리 최소화
          });
          Keyboard.addListener('keyboardWillHide', () => {
            // 기본 위치로 복원 보조
            const fab = document.getElementById('fab-back-to-top');
            const tabbar = document.getElementById('mobile-tabbar');
            if(fab){ fab.style.bottom = '24px'; }
            if(tabbar){ tabbar.style.bottom = '0px'; }
          });
        }
      })();
    </script>

</body>
</html>